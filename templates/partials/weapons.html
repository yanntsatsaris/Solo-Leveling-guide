<div id="weapons" class="tab-content">
  <h2>Armes</h2>
  {% if character.weapon and character.weapon|length > 0 %}
    {% if character.weapon|length == 1 %}
      <!-- Affichage pour une seule arme -->
      <div class="weapons-container">
        {% for weapon in character.weapon %}
        <div class="weapon-card">
          <!-- Conteneur pour l'image et les stats -->
          <div class="weapon-header">
            <div class="weapon-image">
              <img
                src="{{ url_for('static', filename=weapon.image) }}"
                alt="{{ weapon.name }}"
              />
            </div>
            <div class="weapon-stats">
              <strong>{{ weapon.name }}</strong>
              <p>{{ weapon.stats|safe }}</p>
            </div>
          </div>

          <!-- Section des évolutions -->
          {% if weapon.evolutions and weapon.evolutions|length > 0 %}
          <div class="weapon-evolutions">
            <h3>Évolutions</h3>
            <ul>
              {% for evolution in weapon.evolutions %}
              {% if evolution.range %}
              <!-- Afficher les évolutions groupées (A06-A10) -->
              <li>
                <img
                  src="{{ url_for('static', filename='images/Advancement/' ~ evolution.evolution_id ~ '.webp') }}"
                  alt="{{ evolution.evolution_id }}"
                  class="weapon-evolution-image weapon-evolution-range"
                />
                <span>{{ evolution.description|safe }}</span>
              </li>
              {% else %}
              <!-- Afficher les évolutions individuelles (A01 à A05) -->
              <li>
                <img
                  src="{{ url_for('static', filename='images/Advancement/' ~ evolution.evolution_id ~ '.webp') }}"
                  alt="{{ evolution.evolution_id }}"
                  class="weapon-evolution-image"
                />
                <span>{{ evolution.description|safe }}</span>
              </li>
              {% endif %}
              {% endfor %}
            </ul>
          </div>
          {% else %}
          <p>Aucune évolution disponible pour cette arme.</p>
          {% endif %}
        </div>
        {% endfor %}
      </div>
    {% else %}
      <!-- Affichage pour plusieurs armes -->
      {% if session.username and session.rights and ('Admin' in session.rights or 'SuperAdmin' in session.rights) %}
        <button id="add-weapon-btn" class="admin-btn">
          Ajouter une arme
        </button>
        {% include 'partials/add_weapon_modal.html' %}
      {% endif %}
      <div
        class="weapon-types"
      >
        <button
          class="type-button"
          data-type="All"
        >
          All
        </button>
        {% for type in weapon_types %}
        <button
          class="type-button"
          data-type="{{ type }}"
        >
          {{ type }}
        </button>
        {% endfor %}
      </div>
      <div
        class="rarity-filters"
      >
        <button
          class="rarity-button"
          data-rarity="All"
        >
          All
        </button>
        {% for rarity in rarities %}
        <button
          class="rarity-button"
          data-rarity="{{ rarity }}"
        >
          {{ rarity }}
        </button>
        {% endfor %}
      </div>
      <table id="weapons-table">
        <tr>
          {% for weapon in character.weapon %}
          <td data-type="{{ weapon.type }}" data-rarity="{{ weapon.rarity }}">
            <div class="weapon-card-codex">
              {% if weapon.alias %}
              <a href="{{ url_for('weapon_details', weaponAlias=weapon.alias) }}">
                <img
                  src="{{ url_for('static', filename=weapon.codex) }}"
                  alt="{{ weapon.name or 'Weapon Image' }}"
                />
              </a>
              {% else %}
              <img
                src="{{ url_for('static', filename=weapon.codex) }}"
                alt="{{ weapon.name or 'Weapon Image' }}"
              />
              {% endif %}
              <p hidden class="weapon-name">{{ weapon.name }}</p>
              {% if weapon.stats %}
              <p class="weapon-description">{{ weapon.stats|safe }}</p>
              {% endif %}
            </div>
          </td>
          {% if loop.index % 4 == 0 %}
          </tr><tr>
          {% endif %}
          {% endfor %}
        </tr>
      </table>
    {% endif %}
  {% else %}
  <p>Aucune arme disponible pour ce personnage.</p>
  {% endif %}
</div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const typeButtons = document.querySelectorAll(".type-button");
        const rarityButtons = document.querySelectorAll(".rarity-button");
        const weaponCells = document.querySelectorAll("#weapons-table td");

        let selectedType = "All";
        let selectedRarity = "All";

        function filterWeapons() {
          weaponCells.forEach((cell) => {
            const matchesType =
              selectedType === "All" ||
              cell.getAttribute("data-type") === selectedType;
            const matchesRarity =
              selectedRarity === "All" ||
              cell.getAttribute("data-rarity") === selectedRarity;
            cell.style.display = matchesType && matchesRarity ? "" : "none";
          });
        }

        typeButtons.forEach((button) => {
          button.addEventListener("click", () => {
            selectedType = button.getAttribute("data-type");
            filterWeapons();
          });
        });

        rarityButtons.forEach((button) => {
          button.addEventListener("click", () => {
            selectedRarity = button.getAttribute("data-rarity");
            filterWeapons();
          });
        });
      });
    </script>