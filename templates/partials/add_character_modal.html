<dialog id="add-character-dialog" class="edit-character-overlay">
  <div id="add-character-menu" class="edit-character-popup">
    <form id="add-character-form" method="POST" action="{{ url_for('characters_admin.add_character') }}">
      <h2 class="edit-character-title">Ajouter un personnage</h2>
      <div class="edit-tabs">
        <div class="edit-tab active" data-tab="main">Infos principales</div>
        <div class="edit-tab" data-tab="passives">Passifs</div>
        <div class="edit-tab" data-tab="skills">Compétences</div>
        <div class="edit-tab" data-tab="weapons">Armes</div>
        <div class="edit-tab" data-tab="artefacts">Artefacts</div>
      </div>

      <!-- Contenu des onglets -->
      <div class="edit-tab-content active" id="edit-tab-main">
        <label>Nom :</label><input type="text" name="name" required />
        <label>Alias :</label><input type="text" name="alias" required />
        <label>Type :</label><input type="text" name="type" required />
        <label>Rareté :</label><input type="text" name="rarity" required />
        <label>Description :</label><textarea name="description"></textarea>
        <input type="hidden" name="image_folder" value="">
        <h4 class="evolutions-title">Évolutions du personnage</h4>
        <div class="evolutions-grid">
          {% for i in range(7) %}
            <div class="edit-evolution-block">
              <label>Évolution : {{ 'A' ~ i if i != 6 else 'A6-10' }}</label>
              <textarea name="character_evolution_description_{{ i }}"></textarea>
            </div>
          {% endfor %}
        </div>
      </div>

      <div class="edit-tab-content" id="edit-tab-passives">
        <div class="passives-grid" id="passives-grid"></div>
        <button type="button" id="add-passive-btn" class="add-btn">+ Ajouter un passif</button>
      </div>

      <div class="edit-tab-content" id="edit-tab-skills">
        <div class="skills-grid" id="skills-grid"></div>
        <button type="button" id="add-skill-btn" class="add-btn">+ Ajouter une compétence</button>
      </div>

      <div class="edit-tab-content" id="edit-tab-weapons">
          <div class="edit-weapon-block">
            <label>Nom de l'arme :</label><input type="text" name="weapon_name_0" />
            <label>Stats :</label><textarea name="weapon_stats_0"></textarea>
            <label>Tag :</label><input type="text" name="weapon_tag_0" />
            <h4 class="evolutions-title">Évolutions de l'arme</h4>
            <div class="evolutions-grid">
              {% for i in range(7) %}
                  <div class="edit-weapon-evolution-block">
                    <label>Évolution : {{ 'A' ~ i if i != 6 else 'A6-10' }}</label>
                    <textarea name="weapon_evolution_description_0_{{ i }}"></textarea>
                  </div>
              {% endfor %}
            </div>
          </div>
      </div>

      <div class="edit-tab-content" id="edit-tab-artefacts">
          <!-- La logique pour ajouter/gérer les sets sera gérée dynamiquement par JS -->
          <div id="add-artefacts-fields"></div>
      </div>

      <div style="display: flex; justify-content: space-between; margin-top: 18px">
        <button type="submit" class="admin-btn">Enregistrer</button>
        <button type="button" id="close-add-character" class="close-btn" style="font-size: 22px">&times;</button>
      </div>
    </form>
  </div>
</dialog>

<script>
    // Injecte les données dynamiques de Flask dans l'objet global `modalData`
    initializeModalData({
        panopliesList: {{ panoplies_list|tojson }},
        artefactMainStats: {{ artefact_main_stats|tojson }},
        secondaryStatsOptions: {{ secondary_stats_options|tojson }},
        focusStatsOptions: {{ focus_stats_options|tojson }},
        coresList: {{ cores_list|tojson }},
        coreMainStats: {{ core_main_stats|tojson }},
        coreSecondaryStats: {{ core_secondary_stats|tojson }},
        currentLang: "{{ language if language is defined else 'FR-fr' }}"
    });
</script>
<script src="{{ url_for('static', filename='js/add_character_modal.js') }}"></script>
