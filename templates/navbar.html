<link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">

<nav class="navbar">
    <ul>
        <li><a href="/" class="{% if request.path == '/' %}active{% endif %}">Home</a></li>
        <li><a href="/game-contents" class="{% if request.path.startswith('/game-contents') %}active{% endif %}">Game Contents</a></li>
        <li><a href="/SJW" class="{% if request.path.startswith('/SJW') %}active{% endif %}">Sung Jinwoo</a></li>
        <li>
            <a href="/characters" class="{% if request.path.startswith('/characters') %}active{% endif %}">
                Characters
            </a>
        </li>
        <li><a href="/guides" class="{% if request.path == '/guides' %}active{% endif %}">Guides</a></li>
    </ul>
    <div class="language-switch">
        <form method="POST" action="/set-language">
            <select name="language" onchange="this.form.submit()">
                <option value="FR-fr" {% if session.get('language', 'EN-en') == 'FR-fr' %}selected{% endif %}>Français</option>
                <option value="EN-en" {% if session.get('language', 'EN-en') == 'EN-en' %}selected{% endif %}>English</option>
            </select>
        </form>
    </div>
    <div class="user-logo">
        <img src="{{ url_for('static', filename='images/utilisateur-noir.jpg') }}" alt="User" id="user-btn" style="cursor:pointer;" />
    </div>
</nav>

<div id="user-menu-overlay" class="user-menu-overlay" style="display:none;">
    <div id="user-menu" class="user-menu-popup">
        <form id="login-form">
            <h3>Connexion</h3>
            <input type="text" name="username" placeholder="Nom d'utilisateur" required>
            <input type="password" name="password" placeholder="Mot de passe" required>
            <button type="submit">Se connecter</button>
            <button type="button" id="show-register" class="switch-btn">Créer un compte</button>
        </form>
        <form id="register-form" style="display:none;">
            <h3>Créer un compte</h3>
            <input type="email" name="new_email" placeholder="Adresse mail" required>
            <input type="text" name="new_username" placeholder="Nom d'utilisateur" required>
            <input type="password" name="new_password" placeholder="Mot de passe" required>
            <input type="password" name="confirm_password" placeholder="Confirmer le mot de passe" required>
            <button type="submit">Créer</button>
            <button type="button" id="show-login" class="switch-btn">Déjà un compte ?</button>
        </form>
        <button type="button" id="close-user-menu" class="close-btn">&times;</button>
    </div>
</div>

<script>
document.getElementById('user-btn').onclick = function() {
    document.getElementById('user-menu-overlay').style.display = 'flex';
    document.getElementById('login-form').style.display = 'block';
    document.getElementById('register-form').style.display = 'none';
};

document.getElementById('close-user-menu').onclick = function() {
    document.getElementById('user-menu-overlay').style.display = 'none';
};

document.getElementById('show-register').onclick = function() {
    document.getElementById('login-form').style.display = 'none';
    document.getElementById('register-form').style.display = 'block';
};

document.getElementById('show-login').onclick = function() {
    document.getElementById('register-form').style.display = 'none';
    document.getElementById('login-form').style.display = 'block';
};

document.getElementById('register-form').onsubmit = function(e) {
    e.preventDefault();
    const pwd = this.new_password.value;
    const confirm = this.confirm_password.value;
    if (pwd !== confirm) {
        alert("Les mots de passe ne correspondent pas.");
        return;
    }
    fetch('/register', {
        method: 'POST',
        body: new FormData(this)
    }).then(r => r.json()).then(data => {
        if(data.success) {
            alert('Compte créé !');
            location.reload();
        } else {
            alert(data.error);
        }
    });
};
</script>