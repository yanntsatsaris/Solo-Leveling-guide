{% extends "base.html" %}

{% block title %}{{ character.name }}{% endblock %}

{% block head_css %}
    <link rel="stylesheet" href="{{ asset_url_for('static', filename='css/character_details.css') }}">
    <link rel="stylesheet" href="{{ asset_url_for('static', filename='css/partials/edit_character_modal.css') }}">
    <link rel="stylesheet" href="{{ asset_url_for('static', filename='css/partials/review.css') }}">
    <link rel="stylesheet" href="{{ asset_url_for('static', filename='css/partials/weapons.css') }}">
    <link rel="stylesheet" href="{{ asset_url_for('static', filename='css/partials/passives.css') }}">
    <link rel="stylesheet" href="{{ asset_url_for('static', filename='css/partials/skills.css') }}">
    <link rel="stylesheet" href="{{ asset_url_for('static', filename='css/partials/artefacts.css') }}">
{% endblock %}

{% block body_attributes %}
class="{% if character.type %}background-image{% endif %}" style="{% if character.type %}background-image: url('{{ url_for('static', filename='images/Background/BG_' ~ character.type ~ '.webp') }}');{% endif %}"
{% endblock %}

{% block content %}
<article class="character-sheet">
    <aside class="character-portrait">
        <div class="character-image">
            <img src="{{ url_for('static', filename=character.image) }}" alt="{{ character.name }}">
        </div>
    </aside>

    <div class="content-column">
        <div class="container">
            <h1>{{ character.name }}</h1>
            {% if session.username and session.rights and ('Admin' in session.rights or 'SuperAdmin' in session.rights) %}
                <button id="edit-character-btn" class="admin-btn">Modifier le personnage</button>
                {% include 'partials/edit_character_modal.html' %}
            {% endif %}
            <p style="text-align: center; color: #ffcc00; font-weight: bold" hidden>Type: {{ character.type }}</p>

            <div class="character-image">
                <img src="{{ url_for('static', filename=character.image) }}" alt="{{ character.name }}">
            </div>

            <section class="character-info">
                <div class="tabs-and-content">
                    <nav class="tabs">
                        <div class="tab active" data-tab="description">{% if language == "FR-fr" %}Description{% else %}Description{% endif %}</div>
                        <div class="tab" data-tab="weapons">{% if language == "FR-fr" %}Armes{% else %}Weapons{% endif %}</div>
                        <div class="tab" data-tab="passives">{% if language == "FR-fr" %}Passifs{% else %}Passives{% endif %}</div>
                        <div class="tab" data-tab="skills">{% if language == "FR-fr" %}Compétences{% else %}Skills{% endif %}</div>
                        <div class="tab" data-tab="artefacts" id="artefacts-tab">{% if language == "FR-fr" %}Artefacts{% else %}Artefacts{% endif %}</div>
                        <div class="tab" id="dropdown-tab">
                            <select id="equipment-select">
                                {% if character.equipment_sets and character.equipment_sets|length > 0 %}
                                    {% for set in character.equipment_sets %}
                                        <option value="{{ loop.index0 }}">{{ set.set_name }}</option>
                                    {% endfor %}
                                {% else %}
                                    <option disabled>{% if language == "FR-fr" %}Aucun set équipé{% else %}No set equipped{% endif %}</option>
                                {% endif %}
                            </select>
                        </div>
                    </nav>

                    <!-- Contenu des onglets -->
                    {% include 'partials/review.html' %}
                    {% include 'partials/weapons.html' %}
                    {% include 'partials/passives.html' %}
                    {% include 'partials/skills.html' %}
                    {% include 'partials/artefacts.html' %}
                </div>
            </section>
        </div>
    </div>
</article>
{% endblock %}

{% block body_js %}
    <script id="equipmentSetsData" type="application/json">
        {% if character.equipment_sets and character.equipment_sets|length > 0 %}
            {{ character.equipment_sets|tojson }}
        {% else %}
            []
        {% endif %}
    </script>
    <script id="equipmentSetsEffectsData" type="application/json">
        {{ panoplies_effects|tojson }}
    </script>
    <script id="coresEffectsData" type="application/json">
        {{ cores_effects | tojson }}
    </script>
    <script src="{{ asset_url_for('static', filename='js/character_details.js') }}"></script>
{% endblock %}
